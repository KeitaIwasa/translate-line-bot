(() => {
  const translations = {
    en: {
      pageTitle: "KOTORI | Multilingual LINE Translation Bot",
      seoDescription:
        "KOTORI is a multilingual LINE bot you can use just by inviting it to your group. Keep conversations flowing with natural, context-aware translations.",
      heroTagline: "Multilingual translation LINE bot",
      heroTitle: "Keep your LINE group conversation flowing across languages.",
      heroLeadPrimary:
        "KOTORI is a multilingual translation bot you can use just by inviting it to a LINE group.",
      heroLeadSecondary:
        "Conversations stay smooth in your usual LINE flow without language barriers stopping the chat.",
      heroCtaNote: "Add KOTORI on LINE to get started",
      simpleTitle: "All you do is invite KOTORI.",
      simpleLead: "No special registration or setup is required.",
      simpleSteps: [
        "Add KOTORI as a friend on LINE.",
        "Invite it to the group you want to translate.",
        "Keep chatting as usual.",
      ],
      simpleNote: "No app switching or copy & paste needed.",
      useCasesTitle: "Where KOTORI is used",
      useCases: [
        "LINE groups with international students or foreign members",
        "International exchange circles and communities",
        "Coordinating with local members while traveling",
        "Casual or announcement groups that mix Japanese and English",
      ],
      featuresTitle: "KOTORI features",
      features: [
        {
          title: "Context-aware translations",
          body: "Instead of literal translations, AI understands the group context and translates naturally.",
        },
        {
          title: "Mixed languages are okay",
          body: "Even when Japanese, English, or other languages are mixed, KOTORI detects the language and translates automatically.",
        },
      ],
      tryTitle: "Try inviting it to your group first",
      tryLead:
        "The fastest way to see KOTORI’s value is to use it inside real conversations.",
      tryNote: "Invite KOTORI and keep chatting",
      proTitle: "For groups that want more",
      proLead:
        "For high-frequency or long-term use, we also offer an expanded Pro plan.",
      proList: [
        "Translate without worrying about limits",
        "Use it reliably for important groups",
      ],
      proCtaLabel: "See the Pro plan",
      proNote: "Learn more here.",
      footerPro: "Pro plan",
      footerTerms: "Terms of Service",
      footerPrivacy: "Privacy Policy",
      footerConsumer: "Consumer Information",
      footerCopy: "© KOTORI",
    },
    ja: {
      pageTitle: "KOTORI | LINEグループ翻訳ボット",
      seoDescription:
        "KOTORIはLINEグループに招待するだけで使える多言語翻訳ボット。会話の流れを保ったまま自然に翻訳します。",
      heroTagline: "多言語翻訳LINEボット",
      heroTitle: "LINEグループの会話を、自然に多言語翻訳するボット",
      heroLeadPrimary:
        "KOTORIは、LINEグループに招待するだけで使える多言語対応の翻訳LINEボットです。",
      heroLeadSecondary:
        "言語の違いで会話が止まることなく、いつものLINEの流れのままコミュニケーションできます。",
      heroCtaNote: "まずはKOTORIを友だち追加",
      simpleTitle: "KOTORIは「入れるだけ」です",
      simpleLead: "KOTORIに特別な登録や設定は必要ありません。",
      simpleSteps: [
        "LINEでKOTORIを友だち追加",
        "翻訳したいグループに招待",
        "そのまま会話を続けるだけ",
      ],
      simpleNote: "アプリの切り替えも、コピペも不要",
      useCasesTitle: "こんな場面で使われています",
      useCases: [
        "留学生や外国人メンバーがいるLINEグループ",
        "国際交流サークル・コミュニティ",
        "旅行先での現地メンバーとのやり取り",
        "日本語と英語が混在する雑談・連絡用グループ",
      ],
      featuresTitle: "KOTORIの特長",
      features: [
        {
          title: "会話の流れを考慮した翻訳",
          body: "単文を直訳するのではなく、グループ内の文脈をAIが理解して翻訳します。",
        },
        {
          title: "多言語が混ざっても問題なし",
          body: "日本語・英語・その他の言語が混在しても、自動で言語を判別して翻訳します。",
        },
      ],
      tryTitle: "まずは、グループに入れてみてください",
      tryLead:
        "KOTORIが役に立つかどうかは、実際に会話の中で使ってみるのが一番早いです。",
      tryNote: "グループに招待して会話を続けるだけ",
      proTitle: "もっと使いたい方へ",
      proLead:
        "利用頻度が高いグループや、継続的に使いたい方向けの拡張利用も用意しています。",
      proList: ["翻訳制限を気にせず使いたい", "重要なグループで安定して使いたい"],
      proCtaLabel: "Pro利用について",
      proNote: "詳しくは、こちらをご覧ください。",
      footerPro: "Pro利用について",
      footerTerms: "利用規約",
      footerPrivacy: "プライバシーポリシー",
      footerConsumer: "特定商取引法に基づく表記",
      footerCopy: "© KOTORI",
    },
    "zh-TW": {
      pageTitle: "KOTORI | LINE 群組翻譯機器人",
      seoDescription:
        "KOTORI 只要邀請進 LINE 群組就能使用，是支援多語的翻譯機器人，讓對話順暢自然。",
      heroTagline: "多語翻譯 LINE 機器人",
      heroTitle: "讓 LINE 群組對話自然跨語言翻譯",
      heroLeadPrimary:
        "KOTORI 只要邀請進 LINE 群組就能使用，是支援多語的翻譯機器人。",
      heroLeadSecondary:
        "不會因語言差異而中斷對話，維持原本的 LINE 交流節奏。",
      heroCtaNote: "先在 LINE 加入 KOTORI",
      simpleTitle: "KOTORI 只要「邀請進群」即可",
      simpleLead: "不需要特別註冊或設定。",
      simpleSteps: [
        "在 LINE 加入 KOTORI 為好友",
        "邀請到要翻譯的群組",
        "照常聊天即可",
      ],
      simpleNote: "不必切換 App，也不必複製貼上",
      useCasesTitle: "常見使用情境",
      useCases: [
        "有外籍成員或留學生的 LINE 群組",
        "國際交流社團／社群",
        "旅途中與當地成員的聯絡",
        "日英混合的閒聊或聯絡群組",
      ],
      featuresTitle: "KOTORI 的特色",
      features: [
        {
          title: "理解對話脈絡的翻譯",
          body: "不只逐字直譯，AI 會理解群組脈絡並自然翻譯。",
        },
        {
          title: "混合多語也沒問題",
          body: "即使日文、英文或其他語言混在一起，也能自動偵測並翻譯。",
        },
      ],
      tryTitle: "先把它邀進群組試試看",
      tryLead: "最直接的方式就是在真實對話中使用 KOTORI。",
      tryNote: "邀請進群後照常聊天",
      proTitle: "需要更多使用量的人",
      proLead: "對於高頻率或需要長期使用的群組，也提供擴充的 Pro 方案。",
      proList: ["想不受翻譯限制地使用", "希望重要群組更穩定運作"],
      proCtaLabel: "了解 Pro 方案",
      proNote: "詳情請見此處。",
      footerPro: "Pro 方案",
      footerTerms: "服務條款",
      footerPrivacy: "隱私權政策",
      footerConsumer: "消費者資訊",
      footerCopy: "© KOTORI",
    },
    th: {
      pageTitle: "KOTORI | บอตแปลกลุ่ม LINE หลายภาษา",
      seoDescription:
        "KOTORI คือบอต LINE หลายภาษาที่ใช้งานได้ทันที แค่เชิญเข้าไปในกลุ่ม พร้อมแปลอย่างเป็นธรรมชาติให้คุยกันต่อเนื่องได้",
      heroTagline: "บอต LINE แปลหลายภาษา",
      heroTitle: "แปลบทสนทนาในกลุ่ม LINE อย่างเป็นธรรมชาติหลายภาษา",
      heroLeadPrimary:
        "KOTORI คือบอตแปลหลายภาษาที่ใช้ได้ทันที แค่เชิญเข้าไปในกลุ่ม LINE",
      heroLeadSecondary:
        "คุยกันต่อเนื่องในจังหวะเดิมของ LINE โดยไม่สะดุดจากความต่างของภาษา",
      heroCtaNote: "เริ่มจากเพิ่ม KOTORI ใน LINE",
      simpleTitle: "KOTORI แค่เชิญเข้ากลุ่มก็ใช้ได้",
      simpleLead: "ไม่ต้องลงทะเบียนหรือตั้งค่าอะไรเป็นพิเศษ",
      simpleSteps: [
        "เพิ่ม KOTORI เป็นเพื่อนใน LINE",
        "เชิญเข้ากลุ่มที่ต้องการแปล",
        "คุยต่อได้ตามปกติ",
      ],
      simpleNote: "ไม่ต้องสลับแอป และไม่ต้องคัดลอกวาง",
      useCasesTitle: "ใช้ในสถานการณ์แบบนี้บ่อย",
      useCases: [
        "กลุ่มที่มีนักเรียนต่างชาติหรือสมาชิกต่างประเทศ",
        "ชมรม/คอมมูนิตี้แลกเปลี่ยนภาษา",
        "คุยกับคนท้องถิ่นระหว่างเดินทาง",
        "กลุ่มคุยหรือประกาศที่มีญี่ปุ่น-อังกฤษปนกัน",
      ],
      featuresTitle: "จุดเด่นของ KOTORI",
      features: [
        {
          title: "แปลโดยคำนึงถึงบริบทสนทนา",
          body: "ไม่ได้แปลตรงตัวเป็นประโยค ๆ แต่ AI เข้าใจบริบทของกลุ่มก่อนแปล",
        },
        {
          title: "หลายภาษาปนกันก็ไม่เป็นปัญหา",
          body: "แม้จะมีญี่ปุ่น อังกฤษ หรือภาษาอื่นปนกัน ระบบก็ตรวจจับภาษาและแปลอัตโนมัติ",
        },
      ],
      tryTitle: "เริ่มจากเชิญเข้ากลุ่มก่อน",
      tryLead: "วิธีที่เร็วที่สุดคือทดลองใช้จริงในบทสนทนา",
      tryNote: "เชิญเข้ากลุ่มแล้วคุยต่อได้เลย",
      proTitle: "สำหรับคนที่อยากใช้งานมากขึ้น",
      proLead:
        "มีกลุ่มที่ใช้บ่อยหรืออยากใช้งานต่อเนื่อง เรามีแพ็กเกจ Pro ให้เลือก",
      proList: [
        "อยากใช้โดยไม่ต้องกังวลข้อจำกัดการแปล",
        "อยากให้กลุ่มสำคัญใช้งานได้เสถียร",
      ],
      proCtaLabel: "ดูรายละเอียด Pro Plan",
      proNote: "ดูข้อมูลเพิ่มเติมได้ที่นี่",
      footerPro: "Pro Plan",
      footerTerms: "ข้อตกลงการใช้บริการ",
      footerPrivacy: "นโยบายความเป็นส่วนตัว",
      footerConsumer: "กฎหมายการค้าขายของญี่ปุ่น",
      footerCopy: "© KOTORI",
    },
  };

  const STORAGE_KEY = "kotori_lang";
  const seoLocales = {
    ja: "ja_JP",
    en: "en_US",
    "zh-TW": "zh_TW",
    th: "th_TH",
  };

  const elements = {
    heroTagline: document.querySelector("[data-i18n='heroTagline']"),
    heroTitle: document.querySelector("[data-i18n='heroTitle']"),
    heroLeadPrimary: document.querySelector("[data-i18n='heroLeadPrimary']"),
    heroLeadSecondary: document.querySelector("[data-i18n='heroLeadSecondary']"),
    heroCtaNote: document.querySelector("[data-i18n='heroCtaNote']"),
    simpleTitle: document.querySelector("[data-i18n='simpleTitle']"),
    simpleLead: document.querySelector("[data-i18n='simpleLead']"),
    simpleSteps: document.getElementById("simpleSteps"),
    simpleNote: document.querySelector("[data-i18n='simpleNote']"),
    useCasesTitle: document.querySelector("[data-i18n='useCasesTitle']"),
    useCasesList: document.getElementById("useCasesList"),
    featuresTitle: document.querySelector("[data-i18n='featuresTitle']"),
    featureGrid: document.getElementById("featureGrid"),
    tryTitle: document.querySelector("[data-i18n='tryTitle']"),
    tryLead: document.querySelector("[data-i18n='tryLead']"),
    tryNote: document.querySelector("[data-i18n='tryNote']"),
    proTitle: document.querySelector("[data-i18n='proTitle']"),
    proLead: document.querySelector("[data-i18n='proLead']"),
    proList: document.getElementById("proList"),
    proLink: document.getElementById("proLink"),
    proNote: document.querySelector("[data-i18n='proNote']"),
    footerProLink: document.getElementById("footerProLink"),
    footerTermsLink: document.getElementById("footerTermsLink"),
    footerPrivacyLink: document.getElementById("footerPrivacyLink"),
    footerConsumerLink: document.getElementById("footerConsumerLink"),
    footerCopy: document.querySelector("[data-i18n='footerCopy']"),
  };
  const meta = {
    description: document.getElementById("metaDescription"),
    ogTitle: document.getElementById("metaOgTitle"),
    ogDescription: document.getElementById("metaOgDescription"),
    ogUrl: document.getElementById("metaOgUrl"),
    ogLocale: document.getElementById("metaOgLocale"),
    twitterTitle: document.getElementById("metaTwitterTitle"),
    twitterDescription: document.getElementById("metaTwitterDescription"),
    structuredData: document.getElementById("structuredData"),
  };

  const langSelect = document.getElementById("langSelect");
  const flagPaths = {
    ja: "./assets/flags/jp.svg",
    en: "./assets/flags/gb.svg",
    "zh-TW": "./assets/flags/tw.svg",
    th: "./assets/flags/th.svg",
  };
  const lineButtonAssets = {
    ja: {
      src: "https://scdn.line-apps.com/n/line_add_friends/btn/ja.png",
      alt: "友だち追加",
      aria: "友だち追加",
    },
    en: {
      src: "https://scdn.line-apps.com/n/line_add_friends/btn/en.png",
      alt: "Add friend",
      aria: "Add friend",
    },
    "zh-TW": {
      src: "https://scdn.line-apps.com/n/line_add_friends/btn/zh-Hant.png",
      alt: "加入好友",
      aria: "加入好友",
    },
    th: {
      src: "https://scdn.line-apps.com/n/line_add_friends/btn/th.png",
      alt: "เพิ่มเพื่อน",
      aria: "เพิ่มเพื่อน",
    },
  };
  const footerDocPaths = {
    ja: {
      terms: "./docs/terms-ja.html",
      privacy: "./docs/privacy-ja.html",
      consumer: "./docs/consumer-ja.html",
    },
    en: {
      terms: "./docs/terms-en.html",
      privacy: "./docs/privacy-en.html",
      consumer: "./docs/consumer-en.html",
    },
    "zh-TW": {
      terms: "./docs/terms-zh-tw.html",
      privacy: "./docs/privacy-zh-tw.html",
      consumer: "./docs/consumer-zh-tw.html",
    },
    th: {
      terms: "./docs/terms-th.html",
      privacy: "./docs/privacy-th.html",
      consumer: "./docs/consumer-th.html",
    },
  };
  const globeIconPath = "./assets/globe.svg";
  const triggerLabel = "LANGUAGE";

  let customSelectEl;
  let customOptionsEl;
  let customTriggerEl;
  let customTriggerFlagEl;
  let customTriggerTextEl;
  let currentLang = "ja";

  const lineButtons = [
    document.getElementById("lineAddTop"),
    document.getElementById("lineAddBottom"),
  ].filter(Boolean);

  function normalizeLang(raw) {
    if (!raw) return null;
    const value = raw.toLowerCase();
    if (value.startsWith("ja")) return "ja";
    if (value.startsWith("zh")) return "zh-TW";
    if (value.startsWith("th")) return "th";
    return "en";
  }

  function setList(el, items) {
    if (!el) return;
    el.innerHTML = items.map((item) => `<li>${item}</li>`).join("");
  }

  function setFeatures(el, items) {
    if (!el) return;
    el.innerHTML = items
      .map(
        (item) => `
          <div class="feature-card">
            <h3>${item.title}</h3>
            <p>${item.body}</p>
          </div>
        `.trim()
      )
      .join("");
  }

  function updateLineButtons(lang) {
    const asset = lineButtonAssets[lang] || lineButtonAssets.ja;
    lineButtons.forEach((btn) => {
      const img = btn.querySelector("img");
      if (!img) return;
      img.src = asset.src;
      img.alt = asset.alt;
      btn.setAttribute("aria-label", asset.aria);
    });
  }

  function updateDocLinks(lang) {
    const paths = footerDocPaths[lang] || footerDocPaths.ja;
    if (elements.footerTermsLink) elements.footerTermsLink.href = paths.terms;
    if (elements.footerPrivacyLink) elements.footerPrivacyLink.href = paths.privacy;
    if (elements.footerConsumerLink) elements.footerConsumerLink.href = paths.consumer;
  }

  function updateProLinks(lang) {
    const url = `./pro.html?lang=${encodeURIComponent(lang)}`;
    if (elements.proLink) elements.proLink.href = url;
    if (elements.footerProLink) elements.footerProLink.href = url;
  }

  function toggleOptions(forceOpen) {
    if (!customSelectEl || !customTriggerEl || !customOptionsEl) return;
    const willOpen =
      typeof forceOpen === "boolean"
        ? forceOpen
        : !customSelectEl.classList.contains("open");
    customSelectEl.classList.toggle("open", willOpen);
    customTriggerEl.setAttribute("aria-expanded", String(willOpen));
  }

  function updateCustomSelected(lang) {
    if (!customTriggerEl || !customTriggerFlagEl || !customTriggerTextEl) return;
    const selectedOption =
      Array.from(langSelect?.options || []).find((opt) => opt.value === lang) ||
      langSelect?.options?.[0];
    customTriggerFlagEl.src = globeIconPath;
    customTriggerTextEl.textContent = triggerLabel;

    if (customOptionsEl) {
      Array.from(customOptionsEl.children).forEach((li) => {
        const isActive = li.dataset.value === lang;
        li.classList.toggle("active", isActive);
        li.setAttribute("aria-selected", String(isActive));
      });
    }

    if (langSelect && selectedOption) {
      langSelect.value = selectedOption.value;
      const flagUrl = flagPaths[selectedOption.value] || flagPaths.ja;
      const cssUrl = `url("${flagUrl}")`;
      langSelect.style.setProperty("--flag-image", cssUrl);
    }
  }

  function buildCustomSelect() {
    if (!langSelect) return;

    langSelect.style.display = "none";

    customSelectEl = document.createElement("div");
    customSelectEl.className = "lang-select-custom";

    customTriggerEl = document.createElement("button");
    customTriggerEl.type = "button";
    customTriggerEl.className = "lang-select-trigger";
    customTriggerEl.setAttribute("aria-haspopup", "listbox");
    customTriggerEl.setAttribute("aria-expanded", "false");
    customTriggerEl.setAttribute("aria-label", "Language selector");

    customTriggerFlagEl = document.createElement("img");
    customTriggerFlagEl.className = "lang-globe";
    customTriggerFlagEl.alt = "";
    customTriggerFlagEl.src = globeIconPath;

    customTriggerTextEl = document.createElement("span");
    customTriggerTextEl.className = "lang-selected-label";
    customTriggerTextEl.textContent = triggerLabel;

    const arrowEl = document.createElement("span");
    arrowEl.className = "lang-select-arrow";
    arrowEl.textContent = "▾";

    customTriggerEl.append(customTriggerFlagEl, customTriggerTextEl, arrowEl);

    customOptionsEl = document.createElement("ul");
    customOptionsEl.className = "lang-select-options";
    customOptionsEl.setAttribute("role", "listbox");

    Array.from(langSelect.options).forEach((opt) => {
      const li = document.createElement("li");
      li.className = "lang-select-option";
      li.dataset.value = opt.value;
      li.setAttribute("role", "option");

      const flagImg = document.createElement("img");
      flagImg.className = "lang-flag";
      flagImg.alt = "";
      flagImg.src = flagPaths[opt.value] || flagPaths.ja;

      const text = document.createElement("span");
      text.textContent = opt.textContent;

      li.append(flagImg, text);
      li.addEventListener("click", () => {
        applyLang(opt.value);
        toggleOptions(false);
      });

      customOptionsEl.appendChild(li);
    });

    customSelectEl.append(customTriggerEl, customOptionsEl);
    langSelect.insertAdjacentElement("afterend", customSelectEl);

    customTriggerEl.addEventListener("click", () => toggleOptions());
    document.addEventListener("click", (e) => {
      if (!customSelectEl.contains(e.target)) toggleOptions(false);
    });
  }

  function applyLang(lang) {
    currentLang = lang;
    const t = translations[lang] || translations.ja;
    document.documentElement.lang = lang;
    document.title = t.pageTitle;

    if (elements.heroTagline) elements.heroTagline.textContent = t.heroTagline;
    if (elements.heroTitle) elements.heroTitle.textContent = t.heroTitle;
    if (elements.heroLeadPrimary) elements.heroLeadPrimary.textContent = t.heroLeadPrimary;
    if (elements.heroLeadSecondary) elements.heroLeadSecondary.textContent = t.heroLeadSecondary;
    if (elements.heroCtaNote) elements.heroCtaNote.textContent = t.heroCtaNote;

    if (elements.simpleTitle) elements.simpleTitle.textContent = t.simpleTitle;
    if (elements.simpleLead) elements.simpleLead.textContent = t.simpleLead;
    if (elements.simpleSteps) setList(elements.simpleSteps, t.simpleSteps);
    if (elements.simpleNote) elements.simpleNote.textContent = t.simpleNote;

    if (elements.useCasesTitle) elements.useCasesTitle.textContent = t.useCasesTitle;
    if (elements.useCasesList) setList(elements.useCasesList, t.useCases);

    if (elements.featuresTitle) elements.featuresTitle.textContent = t.featuresTitle;
    if (elements.featureGrid) setFeatures(elements.featureGrid, t.features);

    if (elements.tryTitle) elements.tryTitle.textContent = t.tryTitle;
    if (elements.tryLead) elements.tryLead.textContent = t.tryLead;
    if (elements.tryNote) elements.tryNote.textContent = t.tryNote;

    if (elements.proTitle) elements.proTitle.textContent = t.proTitle;
    if (elements.proLead) elements.proLead.textContent = t.proLead;
    if (elements.proList) setList(elements.proList, t.proList);
    if (elements.proLink) elements.proLink.textContent = t.proCtaLabel;
    if (elements.proNote) elements.proNote.textContent = t.proNote;

    if (elements.footerProLink) elements.footerProLink.textContent = t.footerPro;
    if (elements.footerTermsLink) elements.footerTermsLink.textContent = t.footerTerms;
    if (elements.footerPrivacyLink) elements.footerPrivacyLink.textContent = t.footerPrivacy;
    if (elements.footerConsumerLink) elements.footerConsumerLink.textContent = t.footerConsumer;
    if (elements.footerCopy) elements.footerCopy.textContent = t.footerCopy;

    updateProLinks(lang);
    updateDocLinks(lang);
    updateLineButtons(lang);
    updateCustomSelected(lang);

    if (meta.description) meta.description.setAttribute("content", t.seoDescription);
    if (meta.ogTitle) meta.ogTitle.setAttribute("content", t.pageTitle);
    if (meta.ogDescription) meta.ogDescription.setAttribute("content", t.seoDescription);
    if (meta.ogUrl) meta.ogUrl.setAttribute("content", window.location.href);
    if (meta.ogLocale) {
      meta.ogLocale.setAttribute("content", seoLocales[lang] || seoLocales.ja);
    }
    if (meta.twitterTitle) meta.twitterTitle.setAttribute("content", t.pageTitle);
    if (meta.twitterDescription) {
      meta.twitterDescription.setAttribute("content", t.seoDescription);
    }
    if (meta.structuredData) {
      const data = {
        "@context": "https://schema.org",
        "@type": "WebSite",
        name: "KOTORI",
        url: "https://kotori-ai.com/",
        description: t.seoDescription,
        inLanguage: lang,
        publisher: {
          "@type": "Organization",
          name: "KOTORI",
          logo: {
            "@type": "ImageObject",
            url: "https://kotori-ai.com/assets/KOTORIロゴ中.jpg",
          },
        },
      };
      meta.structuredData.textContent = JSON.stringify(data, null, 2);
    }

    try {
      localStorage.setItem(STORAGE_KEY, lang);
    } catch (err) {
      // ローカルストレージが使えない場合は無視する
    }
  }

  function initLanguage() {
    const params = new URLSearchParams(window.location.search);
    const urlLang = normalizeLang(
      params.get("lang") || params.get("language") || params.get("locale")
    );
    let storedLang = null;
    try {
      storedLang = normalizeLang(localStorage.getItem(STORAGE_KEY));
    } catch (err) {
      storedLang = null;
    }
    const browserLang = normalizeLang(navigator.language || navigator.userLanguage);
    const initial = urlLang || storedLang || browserLang || "ja";
    applyLang(initial);
  }

  // 既存のデザインに合わせたカスタムセレクトを生成
  if (langSelect) {
    buildCustomSelect();
    langSelect.addEventListener("change", (e) => applyLang(e.target.value));
  }

  initLanguage();
})();
