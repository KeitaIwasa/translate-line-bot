# LINE グループ名保存対応 ToDo

- 背景: 現状の Join 処理ではボット参加時に `joined_at` の記録・言語設定リセット・翻訳停止設定のみ行っており、グループ名を保持していない。ステータス画面や課金連携でグループ名参照できるよう、参加時に LINE からグループ名を取得して永続化する。

## 実装タスク
- スキーマ拡張: `group_settings` に `group_name` 列（NULL 許可）を追加するマイグレーションを作成し、既存データを保持したままアップサートできるようにする。
- ポート設計: `LinePort` にグループサマリ取得（名称返却）のメソッドを追加し、`MessageRepositoryPort` にグループ名を保存するメソッドを追加する。
- LINE API 実装: `/v2/bot/group/{groupId}/summary` を呼び出して `displayName` を取得する実装を追加し、失敗時は `None` でフォールバックする。
- リポジトリ実装: 新メソッドで受け取ったグループ名を `group_settings` に upsert するロジックを追加し、`translation_enabled` を壊さないようにする。
- Join ハンドラ改修: 参加イベント時にグループサマリを取得→グループ名を保存→既存の join_time 記録・言語設定リセット・翻訳停止設定・初期プロンプト送信を行う。取得失敗時は従来フロー継続。
- テスト追加: Line API グループサマリ取得の正常系/404/エラーハンドリングのテスト、Join ハンドラのグループ名保存呼び出し有無をモックで検証するテストを追加。必要に応じてリポジトリの upsert 挙動を単体テスト。

## リリース手順
- `pytest` を実行して全テストが通ることを確認する。
- ステージング環境にデプロイし、LINE グループでボットを再招待してグループ名が保存されることを確認する。
